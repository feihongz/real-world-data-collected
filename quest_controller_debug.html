<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questæ§åˆ¶å™¨è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #222;
            color: white;
        }
        .debug-section {
            background: rgba(255, 255, 255, 0.1);
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: rgba(0, 255, 0, 0.3); }
        .error { background: rgba(255, 0, 0, 0.3); }
        .warning { background: rgba(255, 255, 0, 0.3); color: black; }
        button {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
            border-radius: 5px;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .gamepad-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        .hand-section {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        .hand {
            flex: 1;
            margin: 0 10px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Questæ§åˆ¶å™¨è°ƒè¯•å·¥å…·</h1>
    
    <div class="debug-section">
        <h2>ğŸ“‹ ç³»ç»Ÿæ£€æŸ¥</h2>
        <div id="systemCheck">æ­£åœ¨æ£€æŸ¥...</div>
    </div>
    
    <div class="debug-section">
        <h2>ğŸ® æ§åˆ¶å™¨çŠ¶æ€</h2>
        <button onclick="startDebugging()">å¼€å§‹è°ƒè¯•</button>
        <button onclick="stopDebugging()">åœæ­¢è°ƒè¯•</button>
        <div id="gamepadsList">è¿˜æœªå¼€å§‹è°ƒè¯•...</div>
    </div>
    
    <div class="debug-section">
        <h2>ğŸ” è¯¦ç»†ä¿¡æ¯</h2>
        <div class="hand-section">
            <div class="hand">
                <h3>ğŸ® å·¦æ§åˆ¶å™¨</h3>
                <div id="leftDebugInfo">ç­‰å¾…æ•°æ®...</div>
            </div>
            <div class="hand">
                <h3>ğŸ® å³æ§åˆ¶å™¨</h3>
                <div id="rightDebugInfo">ç­‰å¾…æ•°æ®...</div>
            </div>
        </div>
    </div>
    
    <div class="debug-section">
        <h2>ğŸ’¡ è§£å†³æ–¹æ¡ˆ</h2>
        <div id="solutions">
            <h3>å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š</h3>
            <ul>
                <li><strong>æ§åˆ¶å™¨æœªæ‰“å¼€ï¼š</strong> ç¡®ä¿ä¸¤ä¸ªQuestæ§åˆ¶å™¨éƒ½å·²å¼€æœº</li>
                <li><strong>ç”µé‡ä¸è¶³ï¼š</strong> æ£€æŸ¥æ§åˆ¶å™¨ç”µé‡ï¼Œç”µé‡ä½æ—¶å¯èƒ½ä¸ç¨³å®š</li>
                <li><strong>è¿½è¸ªä¸¢å¤±ï¼š</strong> ç¡®ä¿æ§åˆ¶å™¨åœ¨Questå¤´æ˜¾çš„è¿½è¸ªèŒƒå›´å†…</li>
                <li><strong>æ‰‹éƒ¨è¿½è¸ªå†²çªï¼š</strong> å…³é—­æ‰‹éƒ¨è¿½è¸ªï¼Œä½¿ç”¨æ§åˆ¶å™¨æ¨¡å¼</li>
                <li><strong>WebXRæƒé™ï¼š</strong> ç¡®ä¿æµè§ˆå™¨å·²æˆäºˆWebXRæƒé™</li>
                <li><strong>è®¾å¤‡é…å¯¹ï¼š</strong> é‡æ–°é…å¯¹æ§åˆ¶å™¨åˆ°Questè®¾å¤‡</li>
            </ul>
        </div>
    </div>

    <script>
        let isDebugging = false;
        let debugLoop = null;

        function checkSystem() {
            const systemCheck = document.getElementById('systemCheck');
            let checks = [];

            // æ£€æŸ¥Gamepad API
            if (navigator.getGamepads) {
                checks.push('<div class="status success">âœ… Gamepad API æ”¯æŒ</div>');
            } else {
                checks.push('<div class="status error">âŒ Gamepad API ä¸æ”¯æŒ</div>');
            }

            // æ£€æŸ¥WebXR
            if (navigator.xr) {
                checks.push('<div class="status success">âœ… WebXR æ”¯æŒ</div>');
            } else {
                checks.push('<div class="status warning">âš ï¸ WebXR ä¸æ”¯æŒ (æŸäº›åŠŸèƒ½å¯èƒ½å—é™)</div>');
            }

            // æ£€æŸ¥æ˜¯å¦åœ¨HTTPSä¸‹è¿è¡Œ
            if (window.location.protocol === 'https:' || window.location.hostname === 'localhost') {
                checks.push('<div class="status success">âœ… å®‰å…¨è¿æ¥</div>');
            } else {
                checks.push('<div class="status warning">âš ï¸ å»ºè®®ä½¿ç”¨HTTPSè¿æ¥</div>');
            }

            systemCheck.innerHTML = checks.join('');
        }

        function startDebugging() {
            isDebugging = true;
            debugLoop = setInterval(debugGamepads, 100); // 10Hzæ›´æ–°
            console.log('å¼€å§‹è°ƒè¯•æ¨¡å¼');
        }

        function stopDebugging() {
            isDebugging = false;
            if (debugLoop) {
                clearInterval(debugLoop);
                debugLoop = null;
            }
            console.log('åœæ­¢è°ƒè¯•æ¨¡å¼');
        }

        function debugGamepads() {
            if (!isDebugging) return;

            const gamepads = navigator.getGamepads();
            const gamepadsList = document.getElementById('gamepadsList');
            const leftInfo = document.getElementById('leftDebugInfo');
            const rightInfo = document.getElementById('rightDebugInfo');

            let detectedGamepads = [];
            let leftController = null;
            let rightController = null;

            // éå†æ‰€æœ‰è®¾å¤‡
            for (let i = 0; i < gamepads.length; i++) {
                const gamepad = gamepads[i];
                if (gamepad && gamepad.connected) {
                    detectedGamepads.push({
                        index: i,
                        id: gamepad.id,
                        connected: gamepad.connected,
                        buttonsCount: gamepad.buttons.length,
                        axesCount: gamepad.axes.length,
                        mapping: gamepad.mapping,
                        hand: gamepad.hand || 'unknown'
                    });

                    // åŸºäºhandå±æ€§æˆ–ç´¢å¼•åˆ†é…å·¦å³æ‰‹
                    if (gamepad.hand === 'left' || (gamepad.hand === 'unknown' && i === 0)) {
                        leftController = gamepad;
                    } else if (gamepad.hand === 'right' || (gamepad.hand === 'unknown' && i === 1)) {
                        rightController = gamepad;
                    }
                }
            }

            // æ˜¾ç¤ºæ£€æµ‹åˆ°çš„è®¾å¤‡
            if (detectedGamepads.length === 0) {
                gamepadsList.innerHTML = '<div class="status error">âŒ æœªæ£€æµ‹åˆ°ä»»ä½•æ§åˆ¶å™¨</div>' +
                    '<div class="gamepad-info">' +
                    '<strong>è§£å†³æ­¥éª¤ï¼š</strong><br>' +
                    '1. ç¡®ä¿æ§åˆ¶å™¨å·²å¼€æœº<br>' +
                    '2. æŒ‰ä¸‹æ§åˆ¶å™¨ä¸Šçš„ä»»æ„æŒ‰é’®æ¿€æ´»<br>' +
                    '3. åœ¨Questè®¾å¤‡ä¸Šæ£€æŸ¥æ§åˆ¶å™¨è¿æ¥çŠ¶æ€<br>' +
                    '4. å°è¯•é‡æ–°é…å¯¹æ§åˆ¶å™¨' +
                    '</div>';
            } else {
                let info = `<div class="status success">âœ… æ£€æµ‹åˆ° ${detectedGamepads.length} ä¸ªæ§åˆ¶å™¨</div>`;
                detectedGamepads.forEach(gp => {
                    info += `<div class="gamepad-info">
                        <strong>æ§åˆ¶å™¨ ${gp.index}:</strong><br>
                        ID: ${gp.id}<br>
                        æ‰‹éƒ¨: ${gp.hand}<br>
                        æŒ‰é’®: ${gp.buttonsCount} ä¸ª<br>
                        è½´: ${gp.axesCount} ä¸ª<br>
                        æ˜ å°„: ${gp.mapping}<br>
                        è¿æ¥çŠ¶æ€: ${gp.connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥'}
                    </div>`;
                });
                gamepadsList.innerHTML = info;
            }

            // æ˜¾ç¤ºå·¦æ§åˆ¶å™¨ä¿¡æ¯
            if (leftController) {
                const buttons = Array.from(leftController.buttons).map((btn, i) => 
                    `æŒ‰é’®${i}: ${btn.pressed ? 'æŒ‰ä¸‹' : 'æœªæŒ‰'} (${btn.value.toFixed(3)})`
                ).join('<br>');
                const axes = Array.from(leftController.axes).map((axis, i) => 
                    `è½´${i}: ${axis.toFixed(3)}`
                ).join('<br>');
                
                leftInfo.innerHTML = `
                    <div class="status success">âœ… å·¦æ§åˆ¶å™¨å·²è¿æ¥</div>
                    <div class="gamepad-info">
                        <strong>æŒ‰é’®çŠ¶æ€:</strong><br>${buttons}<br><br>
                        <strong>è½´çŠ¶æ€:</strong><br>${axes}
                    </div>
                `;
            } else {
                leftInfo.innerHTML = '<div class="status error">âŒ å·¦æ§åˆ¶å™¨æœªæ£€æµ‹åˆ°</div>';
            }

            // æ˜¾ç¤ºå³æ§åˆ¶å™¨ä¿¡æ¯
            if (rightController) {
                const buttons = Array.from(rightController.buttons).map((btn, i) => 
                    `æŒ‰é’®${i}: ${btn.pressed ? 'æŒ‰ä¸‹' : 'æœªæŒ‰'} (${btn.value.toFixed(3)})`
                ).join('<br>');
                const axes = Array.from(rightController.axes).map((axis, i) => 
                    `è½´${i}: ${axis.toFixed(3)}`
                ).join('<br>');
                
                rightInfo.innerHTML = `
                    <div class="status success">âœ… å³æ§åˆ¶å™¨å·²è¿æ¥</div>
                    <div class="gamepad-info">
                        <strong>æŒ‰é’®çŠ¶æ€:</strong><br>${buttons}<br><br>
                        <strong>è½´çŠ¶æ€:</strong><br>${axes}
                    </div>
                `;
            } else {
                rightInfo.innerHTML = `
                    <div class="status error">âŒ å³æ§åˆ¶å™¨æœªæ£€æµ‹åˆ°</div>
                    <div class="gamepad-info">
                        <strong>å¯èƒ½åŸå› :</strong><br>
                        â€¢ æ§åˆ¶å™¨æœªå¼€æœºæˆ–ç”µé‡ä¸è¶³<br>
                        â€¢ æ§åˆ¶å™¨è¶…å‡ºè¿½è¸ªèŒƒå›´<br>
                        â€¢ éœ€è¦æŒ‰ä¸‹æŒ‰é’®æ¿€æ´»<br>
                        â€¢ é…å¯¹è¿æ¥é—®é¢˜<br><br>
                        <strong>è§£å†³æ–¹æ³•:</strong><br>
                        1. æ£€æŸ¥æ§åˆ¶å™¨ç”µæºæŒ‡ç¤ºç¯<br>
                        2. æŒ‰ä¸‹Menuæˆ–Homeé”®æ¿€æ´»<br>
                        3. åœ¨Questè®¾ç½®ä¸­é‡æ–°é…å¯¹<br>
                        4. é‡å¯Questè®¾å¤‡
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç³»ç»Ÿ
        window.onload = function() {
            checkSystem();
            
            // ç›‘å¬gamepadè¿æ¥äº‹ä»¶
            window.addEventListener("gamepadconnected", function(e) {
                console.log("æ§åˆ¶å™¨å·²è¿æ¥:", e.gamepad);
                if (isDebugging) {
                    debugGamepads(); // ç«‹å³æ›´æ–°æ˜¾ç¤º
                }
            });

            window.addEventListener("gamepaddisconnected", function(e) {
                console.log("æ§åˆ¶å™¨å·²æ–­å¼€:", e.gamepad);
                if (isDebugging) {
                    debugGamepads(); // ç«‹å³æ›´æ–°æ˜¾ç¤º
                }
            });
        };
    </script>
</body>
</html>


